{"title":"「GXOI / GZOI2019」旧词                              ","time_limit":1000,"memory_limit":512,"url":"https://guoj.icu/problem/1152","statement":[{"title":"# 题目描述","format":"markdown","require":["katex"],"content":"\n> 浮生有梦三千场  \r\n> 穷尽千里诗酒荒  \r\n> 徒把理想倾倒  \r\n> 不如早还乡\r\n>\r\n> 温一壶风尘的酒  \r\n> 独饮往事迢迢  \r\n> 举杯轻思量  \r\n> 泪如潮青丝留他方\r\n>\r\n> <p style=\"text-align: right; \">——乌糟兽/愚青《旧词》</p>\r\n\r\n你已经解决了五个问题，不妨在这大树之下，吟唱旧词一首抒怀。最后的问题就是关于这棵树的，它的描述很简单。\r\n\r\n给定一棵 $n$ 个点的有根树，节点标号 $1 \\sim n$，$1$ 号节点为根。  \r\n给定常数 $k$。  \r\n给定 $Q$ 个询问，每次询问给定 $x,y$。  \r\n求：\r\n\r\n$$\\sum\\limits_{i \\le x} \\text{depth}(\\text{lca}(i,y))^k$$\r\n\r\n$\\text{lca}(x,y)$ 表示节点 $x$ 与节点 $y$ 在有根树上的最近公共祖先。  \r\n$\\text{depth}(x)$ 表示节点 $x$ 的深度，根节点的深度为 $1$。  \r\n由于答案可能很大，你只需要输出答案模 $998244353$ 的结果。\r\n\n"},{"title":"# 输入格式","format":"markdown","require":["katex"],"content":"\n输入包含 $n+Q$ 行。  \r\n第 $1$ 行，三个正整数 $n,Q,k$。  \r\n第 $i = 2 \\sim n$ 行，每行有一个正整数 $f_i(1 \\le f_i \\le n)$，表示编号为 $i$ 的节点的父亲节点的编号。  \r\n接下来 $Q$ 行，每行两个正整数 $x,y(1 \\le x,y \\le n)$，表示一次询问。\n"},{"title":"# 输出格式","format":"markdown","require":["katex"],"content":"\n输出包含 $Q$ 行，每行一个整数，表示答案模 $998244353$ 的结果。\n"},{"title":"# 样例","format":"markdown","require":["katex"],"content":"\n#### 样例输入\r\n```plain\r\n5 5 2\r\n1\r\n4\r\n1\r\n2\r\n4 3\r\n5 4\r\n2 5\r\n1 2\r\n3 2\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n15\r\n11\r\n5\r\n1\r\n6\r\n```\r\n\r\n#### 样例解释\r\n输入的树：\r\n\r\n![oldword.png](/source/guoj/1152/img/aHR0cHM6Ly9sb2otaW1nLnVweXVuLm1lbmNpLm1lbXNldDAuY24vMjAxOS8wNC8xNS81Y2I0OGEyMmEyZTZjLnBuZw==.png)\r\n\r\n每个点的深度分别为 $1,2,3,2,3$。\r\n\r\n第一个询问 $x = 4,y = 3$，容易求出：  \r\n\r\n$$\\text{lca}(1, 3) = 1\\\\\r\n\\text{lca}(2, 3) = 1\\\\\r\n\\text{lca}(3, 3) = 3\\\\\r\n\\text{lca}(4, 3) = 4$$\r\n\r\n于是 $\\text{depth}(1)^2+\\text{depth}(1)^2+\\text{depth}(3)^2+\\text{depth}(4)^2 = 1+1+9+4 = 15$。\n"},{"title":"# 数据范围与提示","format":"markdown","require":["katex"],"content":"\n|测试点编号|$n$ 的规模|$Q$ 的规模|$k$ 的规模|约定|\r\n|:-:|:-:|:-:|:-:|:-:|\r\n|$1$|$n \\le 2,000$|$Q \\le 2,000$|$1 \\le k \\le 10^9$|无|\r\n|$2$|$n \\le 2,000$|$Q \\le 2,000$|$1 \\le k \\le 10^9$|无|\r\n|$3$|$n \\le 2,000$|$Q \\le 2,000$|$1 \\le k \\le 10^9$|无|\r\n|$4$|$n \\le 2,000$|$Q \\le 2,000$|$1 \\le k \\le 10^9$|无|\r\n|$5$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|存在某个点，其深度为 $n$|\r\n|$6$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|存在某个点，其深度为 $n$|\r\n|$7$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|存在某个点，其深度为 $n$|\r\n|$8$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|存在某个点，其深度为 $n$|\r\n|$9$|$n \\le 50,000$|$Q = n$|$1 \\le k \\le 10^9$|对于第 $i$ 个询问，有 $x = i$|\r\n|$10$|$n \\le 50,000$|$Q = n$|$1 \\le k \\le 10^9$|对于第 $i$ 个询问，有 $x = i$|\r\n|$11$|$n \\le 50,000$|$Q \\le 50,000$|$k = 1$|无|\r\n|$12$|$n \\le 50,000$|$Q \\le 50,000$|$k = 1$|无|\r\n|$13$|$n \\le 50,000$|$Q \\le 50,000$|$k = 2$|无|\r\n|$14$|$n \\le 50,000$|$Q \\le 50,000$|$k = 2$|无|\r\n|$15$|$n \\le 50,000$|$Q \\le 50,000$|$k = 3$|无|\r\n|$16$|$n \\le 50,000$|$Q \\le 50,000$|$k = 3$|无|\r\n|$17$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|无|\r\n|$18$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|无|\r\n|$19$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|无|\r\n|$20$|$n \\le 50,000$|$Q \\le 50,000$|$1 \\le k \\le 10^9$|无|\n\n\n"}]}
{"title":"「HNOI 2018 省队集训 Day 1」Tree                              ","time_limit":1000,"memory_limit":512,"url":"https://guoj.icu/problem/1105","statement":[{"title":"题目描述","format":"markdown","require":["katex"],"content":"\n有一棵$n$个点的树，每个节点上有一个权值$w_i$，最开始根为$1$号点．现在有$3$种类型的操作：\r\n\r\n - `1 root`, 表示将根设为$root$.\r\n - `2 u v x`, 设$u, v$的最近公共祖先为$p$, 将$p$的子树中的所有点的权值加上$x$.\r\n - `3 u`, 查询$u$的子树中的所有点的权值和．\r\n\r\n对于每个$3$操作，输出答案．\n"},{"title":"输入格式","format":"markdown","require":["katex"],"content":"\n第一行三个整数$n, q$，表示树的大小以及操作个数.\r\n\r\n接下来一行$n$个整数表示$w_i$.\r\n\r\n接下来$n - 1$行，每行两个整数$u, v$, 描述树上的一条边．\r\n\r\n接下来$q$行，每行描述一个操作，格式见问题描述． \n"},{"title":"输出格式","format":"markdown","require":["katex"],"content":"\n对于每个$3$操作，输出一行一个整数表示答案．\n"},{"title":"样例","format":"markdown","require":["katex"],"content":"\n**样例 1 输入**\r\n```\r\n6 7\r\n1 4 2 8 5 7\r\n1 2\r\n3 1\r\n4 3\r\n4 5\r\n3 6\r\n3 1\r\n2 4 6 3\r\n3 4\r\n1 6\r\n2 2 4 -5\r\n1 4\r\n3 3\r\n```\r\n\r\n**样例 1 输出**\r\n```\r\n27\r\n19\r\n5\r\n```\r\n\r\n本题有附加样例，请自行下载。\n"},{"title":"数据范围与提示","format":"markdown","require":["katex"],"content":"\n对于所有数据，有$1 \\leq n, q \\leq 3 \\times 10^5, -10^7 \\leq w_i, x \\leq 10^7$.\r\n\r\n| 子任务编号 |        $n,q$         |    特殊限制    | 分值 |\r\n| :--------: | :------------------: | :------------: | :--: |\r\n|     1      |     $\\leq 10^3$      |       无       |  19  |\r\n|     2      |     $\\leq 10^5$      |  没有$1$操作   |  21  |\r\n|     3      |     $\\leq 10^5$      |  没有$2$操作   |  16  |\r\n|     4      |     $\\leq 10^5$      | $2$操作中$u=v$ |  27  |\r\n|     5      | $\\leq 3 \\times 10^5$ |       无       |  17  |\r\n\r\n本题将使用捆绑测试。\r\n\r\n出题人：dy0607\r\n\r\n来源：HNOI 2018 省队集训 Day 1 T1\n\n\n"}]}
{"title":"「ZJOI2019」线段树                              ","time_limit":3000,"memory_limit":512,"url":"https://guoj.icu/problem/1025","statement":[{"title":"题目描述","format":"markdown","require":["katex"],"content":"\n九条可怜是一个喜欢数据结构的女孩子，在常见的数据结构中，可怜最喜欢的就是线段树。\r\n\r\n线段树的核心是懒标记，下面是一个带懒标记的线段树的伪代码，其中 tag 数组为懒标记：\r\n\r\n\r\n$$\r\n\\underline{\\text{                               }}\r\n\\begin{aligned}\r\n1:&\\ \\mathbf{function}\\ \\text{P}\\scriptstyle\\text{USHDOWN}\\normalsize\\Large\\text{(Node)}\\\\\r\n2:& \\qquad \\mathbf{if}\\ \\text{tag[Node]= 1}\\ \\mathbf{then}\\\\\r\n3:& \\qquad\\qquad \\text{tag[Lson(Node)]}\\leftarrow 1\\\\\r\n4:& \\qquad\\qquad \\text{tag[Rson(Node)]}\\leftarrow 1\\\\\r\n5:& \\qquad\\qquad \\text{tag[Node]}\\leftarrow 0\\\\\r\n6:& \\qquad \\mathbf{end\\ if}\\\\\r\n7:&\\ \\mathbf{end\\ function}\\\\\r\n8:&\\\\\r\n9:&\\ \\mathbf{function}\\ \\text{M}\\scriptstyle\\text{ODIFY}\\normalsize\\Large\\text{(Node, }l,\\ r,\\ ql,\\ qr)\\\\\r\n10:& \\qquad \\mathbf{if}\\ [l,r]\\cap\\ [ql,qr]=\\emptyset\\ \\mathbf{then}\\\\\r\n11:& \\qquad\\qquad \\mathbf{return}\\\\\r\n12:& \\qquad\\mathbf{end\\ if}\\\\\r\n13:& \\qquad\\mathbf{if}\\ [l,r]\\subseteq\\ [ql,qr]\\ \\mathbf{then}\\\\\r\n14:& \\qquad\\qquad \\text{tag[Node]}\\leftarrow 1\\\\\r\n15:& \\qquad\\qquad \\mathbf{return}\\\\\r\n16:& \\qquad \\mathbf{end\\ if}\\\\\r\n17:& \\qquad m\\leftarrow \\lfloor\\tfrac{l+r}2\\rfloor\\\\\r\n18:& \\qquad \\text{P}\\scriptstyle\\text{USHDOWN}\\normalsize\\Large\\text{(Node)}\\\\\r\n19:& \\qquad \\text{M}\\scriptstyle\\text{ODIFY}\\normalsize\\Large\\text{(Lson(Node), }l,\\ m,\\ ql,\\ qr)\\\\\r\n20:& \\qquad \\text{M}\\scriptstyle\\text{ODIFY}\\normalsize\\Large\\text{(Rson(Node), }m+1,\\ r,\\ ql,\\ qr)\\\\\r\n21:& \\mathbf{end\\ function}\r\n\\end{aligned}\r\n\\overline{\\text{                               }}\r\n$$\r\n\r\n其中函数 $\\text{Lson(Node)}$ 表示 $\\text{Node}$ 的左儿子， $\\text{Rson(Node)}$ 表示 $\\text{Node}$ 的右儿子。\r\n现在可怜手上有一棵 $[1,n]$ 上的线段树，编号为 $1$。这棵线段树上的所有节点的 tag 均为 $0$。接下来可怜进行了 $m$ 次操作，操作有两种：\r\n\r\n- $1\\ l\\ r$，假设可怜当前手上有 $t$ 棵线段树，可怜会把每棵线段树复制两份（tag 数组也一起复制），原先编号为 $i$ 的线段树复制得到的两棵编号为 $2i-1$ 与 $2i$，在复制结束后，可怜手上一共有 $2t$ 棵线段树。接着，可怜会对所有编号为奇数的线段树进行一次 $\\text{Modify(root},\\ 1,\\ n,\\ l,\\ r)$。\r\n\r\n- $2$，可怜定义一棵线段树的权值为它上面有多少个节点 tag 为 $1$。可怜想要知道她手上所有线段树的权值和是多少。 \n"},{"title":"输入格式","format":"markdown","require":["katex"],"content":"\n第一行输入两个整数 $n,m$ 表示初始区间长度和操作个数。\r\n\r\n接下来 $m$ 行每行描述一个操作，输入保证 $1\\le l\\le r\\le n$。\n"},{"title":"输出格式","format":"markdown","require":["katex"],"content":"\n对于每次询问，输出一行一个整数表示答案，答案可能很大，对 $998244353$ 取模后输出即可。\n"},{"title":"样例","format":"markdown","require":["katex"],"content":"\n## 样例输入\r\n\r\n```plain\r\n5 5\r\n2\r\n1 1 3\r\n2\r\n1 3 5\r\n2\r\n```\r\n\r\n## 样例输出\r\n```plain\r\n0\r\n1\r\n6\r\n```\r\n\r\n## 样例解释\r\n\r\n$[1,5]$ 上的线段树如下图所示：\r\n\r\n![2.6](/source/guoj/1025/img/aHR0cDovL3d3dy53anl5eS50b3Avd3AtY29udGVudC91cGxvYWRzLzIwMTkvMDQvMi42LnBuZw==.png)\r\n\r\n在第一次询问时，可怜手上有一棵线段树，它所有点上都没有标记，因此答案为 $0$。\r\n\r\n在第二次询问时，可怜手上有两棵线段树，按照编号，它们的标记情况为：\r\n\r\n1. 点 $[1,3]$ 上有标记，权值为 $1$。\r\n2. 没有点有标记，权值为 $0$。\r\n\r\n因此答案为 $1$。\r\n\r\n在第三次询问时，可怜手上有四棵线段树，按照编号，它们的标记情况为：\r\n\r\n1. 点 $[1,2],[3,3],[4,5]$ 上有标记，权值为 $3$。\r\n2. 点 $[1,3]$ 上有标记，权值为 $1$。\r\n3. 点 $[3,3],[4,5]$ 上有标记，权值为 $2$。\r\n4. 没有点有标记，权值为 $0$。\r\n\r\n因此答案为 $6$。\n"},{"title":"数据范围与提示","format":"markdown","require":["katex"],"content":"\n|测试点|$n$|$m$|其他约定|\r\n|-|-|-|-|\r\n|$1$|$\\le 1000$|$\\le 10$|无|\r\n|$2$|$\\le 1000$|$\\le 10$|无|\r\n|$3$|$\\le 1000$|$\\le 1000$<!--qaq-->|无|\r\n|$4$|$\\le 1000$|$\\le 1000$<!--qaq-->|无|\r\n|$5$|$\\le 10^5$|$\\le 10^5$<!--qaq-->|询问只有一个|\r\n|$6$|$\\le 10^5$|$\\le 10^5$<!--qaq-->|询问只有一个|\r\n|$7$|$\\le 10^5$|$\\le 10^5$<!--qaq-->|询问只有一个|\r\n|$8$|$\\le 10^5$|$\\le 10^5$<!--qaq-->|无|\r\n|$9$|$\\le 10^5$|$\\le 10^5$<!--qaq-->|无|\r\n|$10$|$\\le 10^5$|$\\le 10^5$<!--qaq-->|无|\n\n\n"}]}
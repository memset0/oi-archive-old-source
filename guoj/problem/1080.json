{"title":"「余姚中学 2019 联测 Day 2」Bohemian Rhapsody 2                              ","time_limit":5000,"memory_limit":1024,"url":"https://guoj.icu/problem/1080","statement":[{"title":"题目描述","format":"markdown","require":["katex"],"content":"\n> \"Is this the real life\r\n>\r\n> Is this just fantasy\"\r\n\r\n这是空前的盛况，属于回归的 Queen 乐队的舞台。\r\n\r\n观众们跟着 Queen 唱着这振奋人心的波西米亚狂想曲。\r\n\r\n没有人知道，Queen 的成员在创作这首歌的时候花费了多少的心思。\r\n\r\n许多许多年之后，后人利用先进的科技分析这首歌的时候，发现这首歌与一个常用的数据结构--树有着密切的关系。\r\n\r\n后人决定模拟这首歌的创作过程。\r\n\r\n一开始有 $m$ 棵树，这 $m$ 棵树排成一排，按照 $1..m$ 编号，这些树的形态都是一样的：都是有 $n$ 个节点的树。\r\n\r\n初始的时候每棵树的每个节点上都有一个音符，节点 $i$ 上的音符编号为 $i$。\r\n\r\n在创作的过程中，需要做出 $q$ 次操作。\r\n\r\n每次操作形如： `l,r,u,v` ，表示对于编号为 $l..r$ 的树，将这棵树中音符 $u$ 所在的节点到音符 $v$ 所在的节点的最短路径上的所有边进行收缩。\r\n\r\n其中“收缩”定义如下：\r\n\r\n对于一条边 $e=(u,v)$，对 $e$ 进行收缩指的是将 $u,v$ 合并成一个新的节点 $w$，并且 $w$ 上的音符的集合为原本 $u,v$ 上的音符集合的并集。\r\n\r\n形式化的，令 $N(u)$ 表示节点 $u$ 上的音符集合，将树 $T=(V,E)$ 中的 $e=(u,v)$ 这条边收缩成新节点 $w$ 得到树 $T'=(V',E')$。\r\n\r\n其中 $V'=(V \\backslash \\{ u,v \\}) \\cup \\{w\\}$。\r\n\r\n对于 $(x,y) \\in E$ 且 $\\{ x,y \\} \\cap \\{u,v\\}=0$，$(x,y)\\in E'$；对于 $(x,y)\\in E$ 且 $x \\in \\{u,v\\},y \\notin \\{u,v \\}$，$(w,y)\\in E'$。\r\n\r\n在进行了 $q$ 次操作之后，对于第 $i$ 棵树，记 $S_i$ 为这棵树中任意两个不同的音符所在的节点之间的距离和（音符 $x,y$ 和音符 $y,x$ 只用计算一次）\r\n\r\n得出的 $S$ 序列就是根据这 $q$ 个操作得到的乐谱！\r\n\r\n现在给你 $n,m,q$，这棵树初始的形态以及 $q$ 次操作，请你求出 $S$。\r\n\r\n由于输出的数据量较大，请输出对 $S$ 加密的结果：\r\n$$\\sum_{i=1}^{m}S_i \\times {12345678}^i\\mod 10^9+7$$\r\n\n"},{"title":"输入格式","format":"markdown","require":["katex"],"content":"\n从标准输入读入。\r\n\r\n第一行三个整数 $n,m,q$，分别表示树中的节点数，树的数量以及操作数。\r\n\r\n接下来 $n-1$ 行，每行两个整数 $u,v$，表示树中的一条边 $(u,v)$。\r\n\r\n接下来 $q$ 行，每行四个整数 $l,r,u,v$，表示对于编号为 $l..r$ 的树，将这棵树中音符 $u$ 所在的节点到音符 $v$ 所在的节点的最短路径上的所有边进行收缩。\n"},{"title":"输出格式","format":"markdown","require":["katex"],"content":"\n输出到标准输出。\r\n\r\n一行一个整数，表示对 $S$ 加密的结果。\n"},{"title":"样例","format":"markdown","require":["katex"],"content":"\n#### 样例输入1\r\n```plain\r\n7 10 5\r\n1 2\r\n2 3\r\n3 4\r\n3 5\r\n2 6\r\n5 7\r\n2 6 4 5\r\n2 10 5 6\r\n6 10 6 1\r\n1 2 4 2\r\n4 5 5 4\r\n```\r\n\r\n#### 样例输出1\r\n```plain\r\n411628501\r\n```\r\n\r\n#### 样例解释1\r\n\r\n最终的 $S$ 为 `28 12 12 12 12 6 12 12 12 12`\n"},{"title":"数据范围与提示","format":"markdown","require":["katex"],"content":"\n本题采用捆绑测试。\r\n\r\n对于所有数据，$n,m,q\\le 500000$\r\n\r\n子任务如下：\r\n\r\n- Subtask3（20分）给出的树是一条链，节点$i$和$i+1$之间存在一条边\r\n- Subtask4（20分）给出的树的形态完全随机\r\n- Subtask7（20分）无特殊限制\r\n\r\n其余 Subtask 见 [Problem 1079](/problem/1079)\r\n\r\n命题人：samjia2000\n\n\n"}]}
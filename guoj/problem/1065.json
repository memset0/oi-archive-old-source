{"title":"「十二省联考 2019」字符串问题                              ","time_limit":10000,"memory_limit":1024,"url":"https://guoj.icu/problem/1065","statement":[{"title":"题目描述","format":"markdown","require":["katex"],"content":"\nYazid 和 Tiffany 喜欢字符串问题。在这里，我们将给你介绍一些关于字符串的基本概念。  \r\n\r\n对于一个字符串 $S$，我们定义 $|S|$ 表示 $S$ 的长度。\r\n\r\n接着，我们定义该串的子串 $S(L, R)$ 表示由 $S$ 中从左往右数，第 $L$ 个字符到第 $R$个字符依次连接形成的字符串，特别地，如果 $L<1$ 或 $R>|S|$ 或 $L>R$，则 $S(L,R)$ 表示空串。\r\n\r\n我们说两个字符串相等，当且仅当它们的长度相等，且从左至右各位上的字符依次相同。  \r\n\r\n我们说一个字符串 $T$ 是 $S$ 的**前缀**，当且仅当 $S(1, |T|) = T$。  \r\n\r\n两个字符串 $S$, $T$ 相加 $S+T$ 表示的是在 $S$ 后紧挨着写下 $T$ 得到的长度为 $|S| + |T|$ 的字符串。\r\n\r\n现有一个字符串 $S$。 \r\n\r\nTiffany 将从中划出 $n_a$ 个子串作为 A 类串，第 $i$ 个（$1\\le i\\le n_a$）为 $A_i = S(la_i,ra_i)$。 \r\n\r\n类似地，Yazid 将划出 $n_b$ 个子串作为 $B$ 类串，第 $i$ 个（$1\\le i\\le n_b$）为 $B_i = S(lb_i,rb_i)$。 \r\n\r\n现额外给定 $m$ 组支配关系，每组支配关系 $(x,y)$ 描述了第 $x$ 个 A 类串**支配**第 $y$ 个 B 类串。 \r\n\r\n求一个**长度最大**的目标串 $T$，使得存在一个串 $T$ 的分割 $T = t_1 +t_2 + \\cdots +t_k$（$k \\ge 0$）满足：  \r\n\r\n- 分割中的每个串 $t_i$ 均为 A 类串：即存在一个与其相等的 A 类串，不妨假设其为 $t_i = A_{id_i}$。  \r\n- 对于分割中所有相邻的串 $t_i, t_{i+1}$（$1\\leq i < k$），都有存在一个 $A_{id_i}$ 支配的 B 类串，使得该 B 类串为 $t_{i+1}$ 的前缀。  \r\n\r\n方便起见，你只需要输出这个最大的长度即可。 \r\n\r\n特别地，如果存在无限长的目标串（即对于任意一个正整数 $n$，都存在一个满足限制的长度超过 $n$ 的串），请输出 $-1$。\n"},{"title":"输入格式","format":"markdown","require":["katex"],"content":"\n从标准输入中读入数据。\r\n\r\n单个测试点中包含多组数据，输入的第一行包含一个非负整数 $T$ 表示数据组数。接下来依次描述每组数据，对于每组数据： \r\n\r\n- 第 $1$ 行一个只包含小写字母的字符串 $S$。\r\n- 第 $2$ 行一个非负整数 $n_a$，表示 A 类串的数目。接下来 $n_a$ 行，每行 $2$ 个用空格隔开的整数。\r\n  - 这部分中第 $i$ 行的两个数分别为 $la_i,ra_i$，描述第 $i$ 个 A 类串。\r\n  - 保证 $1\\le la_i\\le ra_i\\le |S|$。\r\n- 接下来一行一个非负整数 $n_b$，表示 B 类串的数目。接下来 $n_b$ 行，每行 $2$ 个用空格隔开的整数。\r\n  - 这部分中第 $i$ 行的两个数分别为 $lb_i,rb_i$，描述第 $i$ 个 B 类串。\r\n  - 保证 $1\\le lb_i\\le rb_i\\le|S|$。\r\n- 接下来一行一个非负整数 $m$，表示支配关系的组数。接下来 $m$ 行，每行 $2$ 个用空格隔开的整数。\r\n   - 这部分中每行的两个整数 $x,y$，描述一对 $(x,y)$ 的支配关系，具体意义见【题目描述】。\r\n   - 保证 $1\\le x\\le n_a$，$1\\le y\\le n_b$。保证所有支配关系两两不同，即不存在两组支配关系的 $x,y$ **均**相同。\n"},{"title":"输出格式","format":"markdown","require":["katex"],"content":"\n输出到标准输出中。\r\n\r\n依次输出每组数据的答案，对于每组数据：\r\n- 一行一个整数表示最大串长。特别地，如果满足限制的串可以是无限长的，则请输出 $-1$。\n"},{"title":"样例","format":"markdown","require":["katex"],"content":"\n### 样例$1$输入\r\n\r\n```plain\r\n3\r\nabaaaba\r\n2\r\n4 7\r\n1 3\r\n1\r\n3 4\r\n1\r\n2 1\r\nabaaaba\r\n2\r\n4 7\r\n1 3\r\n1\r\n7 7\r\n1\r\n2 1\r\nabbaabbaab\r\n4\r\n1 5\r\n4 7\r\n6 9\r\n8 10\r\n3\r\n1 6\r\n10 10\r\n4 6\r\n5\r\n1 2\r\n1 3\r\n2 1\r\n3 3\r\n4 1\r\n```\r\n\r\n### 样例$1$输出\r\n\r\n```plain\r\n7\r\n-1\r\n13\r\n```\r\n\r\n### 样例$1$解释  \r\n\r\n对于第 $1$ 组数据，$A$ 类串有 $\\underline{\\verb|aaba|}$ 与 $\\underline{\\verb|aba|}$，$B$ 类串有 $\\underline{\\verb|aa|}$，且 $A_2$ 支配 $B_1$。我们可以找到串 $\\underline{\\verb|abaaaba|}$，它可以拆分成 $A_2+A_1$，且 $A_1$ 包含由 $A_2$ 所支配的 $B_1$ 作为前缀。可以证明不存在长度更大的满足限制的串。\r\n\r\n对于第 $2$ 组数据，与第 $1$ 组数据唯一不同的是，唯一的 $B$ 类串为 $\\underline{\\verb|a|}$。容易证明存在无限长的满足限制的串。  \r\n\r\n对于第 $3$ 组数据，容易证明 $\\underline{\\verb|abbaabbaaaabb|}$ 是最长的满足限制的串。\r\n\r\n## 样例 2\r\n\r\n见选手目录下的 `string/string2.in` 与 `string/string2.ans`。\r\n\r\n## 样例 3\r\n\r\n见选手目录下的 `string/string3.in` 与 `string/string3.ans`。\r\n\r\n## 样例 3 解释\r\n\r\n这个测试点满足【子任务】中提到的 $\\left|A_i\\right|\\ge \\left|B_j\\right|$ 的限制。\n"},{"title":"数据范围与提示","format":"markdown","require":["katex"],"content":"\n|$n_a$|$n_b$|$\\mid S\\mid$|测试点|$m$|$\\left\\vert A_i\\right\\vert\\ge\\left\\vert B_j\\right\\vert$|其他限制|\r\n|:-:|:-:|:-:|:-:|:-:|:-:|:-:|\r\n|$\\le 100$|$\\le 100$|$\\le 10^4$|$1$|$\\le 10^4$|保证|保证所有 $\\left\\vert A_i\\right\\vert,\\left\\vert B_j\\right\\vert\\le 100$|\r\n|$\\le 1000$|$\\le 1000$|$\\le 2\\times 10^5$|$2\\sim 3$|$\\le 2\\times 10^5$|保证|无|\r\n|$=1$|$\\le 2\\times 10^5$|$\\le 2\\times 10^5$|$4$|$=n_b$|保证|无|\r\n|$\\le 2\\times 10^5$|$\\le 2\\times 10^5$|$\\le 2\\times 10^5$|$5\\sim 6$|$\\le 2\\times 10^5$|保证|保证所有 $ra_i+1=la_{i+1}$|\r\n|$\\le 2\\times 10^5$|$\\le 2\\times 10^5$|$\\le 2\\times 10^5$|$7\\sim 8$|$\\le 2\\times 10^5$|保证|无|\r\n|$\\le 2\\times 10^5$|$\\le 2\\times 10^5$|$\\le 2\\times 10^5$|$9\\sim 10$|$\\le 2\\times 10^5$|不保证|无|\r\n\r\n为了方便你的阅读，我们把**测试点编号**放在了表格的中间，请你注意这一点。\r\n\r\n表格中的 $\\left|A_i\\right|\\ge \\left|B_j\\right|$ 指的是**任意** B 类串的长度不超过**任意** A 类串的长度。\r\n\r\n对于所有测试点，保证：$T\\le 100$，且对于测试点内所有数据，$|S|,n_a,n_b,m$ 的**总和**分别不会超过**该测试点中对应的单组数据的限制**的 $10$ 倍。比如，对于第 $1$ 组测试点，就有 $\\sum n_a\\le 10\\times 100=1000$ 等。特别地，我们规定对于测试点 $4$，有 $T\\le 10$。\r\n\r\n对于所有测试点中的每一组数据，保证：$1\\le |S|\\le 2\\times 10^5$，$n_a,n_b\\le 2\\times 10^5$，$m\\le 2\\times 10^5$。\r\n\r\n## 提示\r\n\r\n十二省联考命题组温馨提醒您：\r\n\r\n**数据千万条，清空第一条。**\r\n\r\n**多测不清空，爆零两行泪。**\n\n\n"}]}
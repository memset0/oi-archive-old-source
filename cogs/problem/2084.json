{"title":"[SYOI 2015] Asm.Def的基本算法","time_limit":1000,"memory_limit":256,"url":"http://cogs.pro:8080/cogs/problem/problem.php?pid=vyiJNVaUq","statement":[{"title":"# 题目描述","format":"html","require":["katex"],"content":"\n\n<h3>\n【题目描述】\n</h3>\n<p>\n<br/>\n</p>\n<p>\n“有句美国俗语说，如果走起来像鸭子，叫起来像鸭子，那就是一只鸭子。”斯科特·华莱士看着Asm.Def面前屏幕上滚动的绿色字符，若有所思地说。\n</p>\n<p>\n“什么意思？”\n</p>\n<p>\n“你的数据。看上去是一棵树。”\n</p>\n<p>\n“按照保密条令，我什么也不说这是最好的——但见你这么热情，一句话不说也不好。”Asm.Def停下手中的快速数论变换，“确实是树。”\n</p>\n<p>\n“然后你怎么算出来目标的位置？”\n</p>\n<p>\n“都需要按照基本算法，按照图论的那一套理论，去产生。听说过LCA吗？不是那个印度飞机，我是说最近公共祖先……”\n</p>\n<p>\n<img src=\"/upload/image/20151102/20151102074424_70821.jpg\" alt=\"\"/> \n</p>\n<p>\nAsm.Def通过分析无线电信号得到了一棵有n个节点，以1为根的树。除1之外，节点i的父亲是p_i。节点带有权值，节点i的权值是w_i。\n</p>\n<p>\n我们定义某点的祖先为从根到它路径上的所有点（包括它本身），而两个节点a、b的最近公共祖先是某个点p，使得p同时是a、b的祖先，而且p离根最远。\n</p>\n<p>\nAsm.Def想要求出\n</p>\n<p>\n<img src=\"/upload/image/20151102/20151102062808_87121.jpg\" alt=\"\"/> \n</p>\n<p>\n（文字：∑∑w_i*w_j*w_LCA(i,j)），\n</p>\n<p>\n其中LCA(i,j)是i、j的最近公共祖先，他认为这个值至关重要。由于这个值可能很大，Asm.Def只需要知道它模1,000,000,007（即10^9+7）的结果。\n</p>\n<p>\n<br/>\n</p>\n<h3>\n【输入格式】\n</h3>\n<p>\n<br/>\n</p>\n<p>\n第1行两个整数：n和w_1.\n</p>\n<p>\n第2行到第n行，第i行有两个整数p_i和w_i。\n</p>\n<p>\n<br/>\n</p>\n<h3>\n【输出格式】\n</h3>\n<p>\n一行一个整数，即答案模1,000,000,007的值。\n</p>\n<h3>\n【样例输入】\n</h3>\n<pre>2 2\n1 1</pre>\n<h3>\n【样例输出】\n</h3>\n<pre>17</pre>\n<h3>\n【提示】\n</h3>\n<p>\n<br/>\n</p>\n<p>\n1×1×1+1×2×2+2×1×2+2×2×2=17。\n</p>\n<p>\n对于30%的数据，n&lt;=100，w_i&lt;=10。\n</p>\n<p>\n对于60%的数据，n&lt;=1000，w_i&lt;=1000.\n</p>\n<p>\n对于100%的数据，1&lt;=n&lt;=10^5，0&lt;=w_i&lt;=10^9，1&lt;=p_i&lt;i.\n</p>\n<p>\n<br/>\n</p>\n<h3>\n【来源】\n</h3>\n<p>\n“Asm.Def战记之太平洋”杯\n</p>\n\n"}]}
{"title":"文艺平衡树（变态版）","time_limit":1000,"memory_limit":64,"url":"http://cogs.pro:8080/cogs/problem/problem.php?pid=vNyiQVPeV","statement":[{"title":"# 题目描述","format":"html","require":["katex"],"content":"\n\n<h3>\n【题目描述】\n</h3>\n<p>\n给定一个序列，请编写一种数据结构来完成以下操作：\n</p>\n<p>\n1. 输入 $l,r,k$；对区间 $[l,r]$ 每个数加上$k$；\n</p>\n<p>\n2. 输入 $l,r$；输出区间 $[l,r]$ 的和，并对$1e9+7$取模；\n</p>\n<p>\n3. 输入 $l,k$；在位置$l$后添加一个大小为$k$的节点；\n</p>\n<p>\n4. 输入 $l,r$；删除区间 $[l,r]$；\n</p>\n<p>\n5. 输入 $l,r$；输出区间 $[l,r]$ 最大值；\n</p>\n<p>\n6. 输入 $l,r$；输出区间 $[l,r]$ 最小值；\n</p>\n<p>\n7. 输入 $l,r,k$；将区间$[l,r]$的值全部改为k；\n</p>\n<p>\n8. 输入 $l,r$；反转区间 $[l,r]$；\n</p>\n<p>\n注意：对于删除添加操作，例如在位置$i$后添加值$k$，那么$k$的位置为$i+1$，原$i+1$位置的数的位置为$i+2$，以此类推。若删除区间 $[l,r]$ 那么原$r+1$位置的数的位置变为$l$以此类推。即每个数的位置不固定，为当前序列的相对位置。\n</p>\n<h3>\n【输入格式】\n</h3>\n<p>\n第一行有两个正整数 $n,m$;\n</p>\n<p>\n第二行$n$个整数，为序列初始值.\n</p>\n<p>\n以下$m$行每行一个操作，第一个数为操作编号，后面为它所对应的输入；\n</p>\n<p>\n保证一切输入均为非负数，且不会有错误情况（$l,r$超边界等）；\n</p>\n<h3>\n【输出格式】\n</h3>\n<p>\n对于操作2、5、6，输出对应的值，每行一个（含输出操作的）操作输出；\n</p>\n<h3>\n【样例输入】\n</h3>\n<pre>5 8\n1 2 3 4 5\n1 1 5 1\n2 1 5\n3 5 7\n4 6 6\n5 1 5\n6 1 5\n7 1\n8 1 5\n</pre>\n<h3>\n【样例输出】\n</h3>\n<pre>20\n6\n2\n2\n</pre>\n<h3>\n【提示】\n</h3>\n<p>\n保证除求和(操作2)外其他结果均在long long范围内。\n</p>\n<p>\n**提示:求max/min时取模会使答案错误。**\n</p>\n<p>\n共20个测试点:\n</p>\n<p>\n对于 50% 的数据，$n,m≤10000$;\n</p>\n<p>\n对于 90% 的数据，$n,m≤100000$;\n</p>\n<p>\n对于 100% 的数据，$n≤300000,m≤100000$.\n</p>\n<h3>\n【来源】\n</h3>\n<p>\nby _SMY\n</p>\n\n"}]}
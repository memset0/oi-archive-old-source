{"title":"填数游戏","time_limit":1000,"memory_limit":128,"url":"http://cogs.pro:8080/cogs/problem/problem.php?pid=vimSyjaWe","statement":[{"title":"题目描述","format":"html","require":["katex"],"content":"\n\n<h3>\n【题目描述】\n</h3>\n<p>\n小 P 和小 Z 经常在一起切磋智商，今天他们在玩填数游戏。\n</p>\n<p>\n现在有一张n*m的矩阵，矩阵中每个格子只能填1或-1，小 P 已经提前在矩阵中填好了k个格子，现在他问小 Z，有多少种不同的方法填剩下的格子，使得矩阵满足任意一行或一列中所有数的积都是-1？（两种方法不同当且仅当两种方法中某个格子填的数不同）。小 Z 乞求小 P 降低题目难度，于是小 P 又给出了一个条件，k<strong>严格小于</strong>n和m的最大值，且最后的答案模p就可以了。“聪明”的小 Z 还是不会做，于是他找到了你。\n</p>\n<h3>\n【输入格式】\n</h3>\n<p>\n输入第一行包含两个整数n和m，代表矩阵的大小。\n</p>\n<p>\n第二行包含一个整数k，代表已经填好的格子数。\n</p>\n<p>\n接下来k行，每行三个整数a,b,c，代表第a行，第b列，填了数c。\n</p>\n<p>\n最后一行包含一个整数p，代表需要将答案模p。\n</p>\n<h3>\n【输出格式】\n</h3>\n<p>\n输出只有一行，一个整数表示最后的答案。\n</p>\n<h3>\n【样例输入1】\n</h3>\n<p>\n2 2\n</p>\n<p>\n1\n</p>\n<p>\n2 2 -1\n</p>\n<p>\n2333\n</p>\n<h3>\n【样例输出1】\n</h3>\n1\n<h3>\n【样例输入2】\n</h3>\n<p>\n983 533\n</p>\n<p>\n3\n</p>\n<p>\n1 3 1\n</p>\n<p>\n4 2 -1\n</p>\n<p>\n100 100 1\n</p>\n<p>\n666666666\n</p>\n<h3>\n【样例输出2】\n</h3>\n<pre>195328496\n</pre>\n<h3>\n【样例1说明】\n</h3>\n<p>\n<br/>\n</p>\n<p>\n2×2 的矩阵，右下角填了-1，所以只有\n</p>\n<p>\n-1 1\n</p>\n<p>\n1 -1\n</p>\n<p>\n这一种填法。\n</p>\n<p>\n<br/>\n</p>\n<h3>\n【数据规模与约定】\n</h3>\n<p>\n<br/>\n</p>\n<p>\n对于 30%的数据，1 ≤ n*m ≤ 21。\n</p>\n<p>\n对于 70%的数据，1 ≤ n,m ≤ 1000。\n</p>\n<p>\n其中有 10%的数据，1 ≤ n,m ≤ 1000,k = 0\n</p>\n<p>\n对于 100%的数据，1 ≤ n,m ≤ 1000000,\n</p>\n<p>\n0 ≤ k &lt; max (n,m),\n</p>\n<p>\n1 ≤ a ≤ n, 1 ≤ b ≤ m, c∈ {1,-1},\n</p>\n<p>\n2 ≤ p ≤ 10^9 + 7,\n</p>\n<p>\n数据保证不会出现一个格子填两次。\n</p>\n<p>\n<br/>\n</p>\n\n"}]}
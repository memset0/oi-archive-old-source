{"title":"[HZOI 2015]QAQ的LIS树","time_limit":2000,"memory_limit":512,"url":"http://cogs.pro:8080/cogs/problem/problem.php?pid=vmSiiVjWW","statement":[{"title":"题目描述","format":"html","require":["katex"],"content":"\n\n<h3>\n【题目描述】\n</h3>\n<p>\nQAQ喜欢玩LIS，有一天他看到这样的一道题目：\n</p>\n<p>\n给定一棵树，求最长的路径使得路径上所有的点权连起来是一个上升序列\n</p>\n<p>\n他思考了一下用树分治切掉了这道题目，不过QAQ觉得这样的题目非常的因缺思烃\n</p>\n<p>\n于是就有了如下题目：\n</p>\n<p>\nQAQ生成了一棵树，树的大小为n，节点为0-&gt;n-1，根为0\n</p>\n<p>\n一开始所有点权都是0，有如下操作：\n</p>\n<p>\n1、M u v QAQ施展LIS大魔法，将u点的点权+v\n</p>\n<p>\n2、C u  QAQ施展LIS小魔法，他可以花费1点魔法值将某个点的点权+1，他现在希望u点到根节点的路径所有的点权构成一个上升序列\n</p>\n<p>\n他需要你告诉他最少需要花费多少点魔法值才能完成这件事情\n</p>\n<p>\n注意由于QAQ很懒而且很弱，魔法值很少，所以对于操作2他并不会去真正的更改点权，也就是2的询问对点权不会产生影响\n</p>\n<h3>\n【输入格式】\n</h3>\n<p>\n第一行输入n表示点数\n</p>\n<p>\n以下n-1行，每行一个正整数，第i行的正整数表示i节点的父亲\n</p>\n<p>\n之后输入m表示操作次数\n</p>\n<p>\n以下m行每行一个操作如题意所示\n</p>\n<h3>\n【输出格式】\n</h3>\n<p>\n对于每个操作2输出答案\n</p>\n<h3>\n【样例输入】\n</h3>\n<pre><p>\n5\n</p>\n\n<p>\n0\n</p>\n\n<p>\n1\n</p>\n\n<p>\n1\n</p>\n\n<p>\n2\n</p>\n\n<p>\n5\n</p>\n\n<p>\nM 4 1572\n</p>\n\n<p>\nM 4 13890\n</p>\n\n<p>\nC 1\n</p>\n\n<p>\nC 4\n</p>\n\n<p>\nC 0\n</p>\n</pre>\n<h3>\n【样例输出】\n</h3>\n<pre><p>\n1\n</p>\n\n<p>\n46392\n</p>\n\n<p>\n0\n</p>\n</pre>\n<h3>\n【提示】\n</h3>\n<p>\n有30%的数据，n&lt;=1000,m&lt;=2000\n</p>\n<p>\n另外有20%的数据，树是随机的\n</p>\n<p>\n另外有20%的数据，树是一条链\n</p>\n<p>\n另外有10%的数据，所有点的父亲都是根\n</p>\n<p>\n对于100%的数据，n&lt;=50000,m&lt;=100000,v&lt;=2^16\n</p>\n<p>\n出题人非常的良心，开了标程两倍左右的时限OwO\n</p>\n\n"}]}
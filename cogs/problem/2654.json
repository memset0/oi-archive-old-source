{"title":"Mike的新同学","time_limit":2000,"memory_limit":512,"url":"http://cogs.pro:8080/cogs/problem/problem.php?pid=vQJSSVegq","statement":[{"title":"# 题目描述","format":"html","require":["katex"],"content":"\n\n<h3>\n【题目描述】\n</h3>\n<p>\nMike第一次坐在文科15班的教室中，见到了许多新同学。Mike记忆力极差，为了记住同学们的名字，Mike准备他们的名字抄下来。Mike又太懒，于是他把这项工作交给了你。\n</p>\n<p>\nMike一共有3种命令：第一种，在名单里加入一个同学的名字S(均为小写字母)；第二种，Mike看错了第i次加入的同学的名字，在他的名字后面插入字符串T(可能进行多次插入)；第三种，Mike发现从第i+1个命令开始脑子抽了，于是要求你回到第i次操作后。\n</p>\n<p>\n为了检验你做的是否正确，Mike要求你立即回答出每次操作后，名单中本质不同的回文子串数量。\n</p>\n<h3>\n【输入格式】\n</h3>\n<p>\n第一行一个整数n，表示Mike一共有n个命令。\n</p>\n<p>\n接下来n行，每行开始有一个整数tp，表示是哪一种命令。\n</p>\n<p>\n除了tp外，读入的所有数字都要异或last_ans来解码，最开始last_ans=0。\n</p>\n<p>\ntp=1时，接下来是一个字符串S，表示这位同学的名字。\n</p>\n<p>\ntp=2时，接下来是一个整数i和一个字符串T，表示在第i次加入的名字后面插入T。(可能多次插入，保证这个同学的名字在当前的名单中)\n</p>\n<p>\ntp=3时，接下来是一个整数i，表示回到第几次操作后，若i=0，则回到最开始的时候。保证不会跳转到当前版本不存在的版本中。\n</p>\n<p>\n一个合法的数据是\n</p>\n<p>\n1 i\n</p>\n<p>\n1 i\n</p>\n<p>\n3 2\n</p>\n<p>\n3 1\n</p>\n<p>\n而下面的是不合法的\n</p>\n<p>\n1 i\n</p>\n<p>\n1 i\n</p>\n<p>\n3 1\n</p>\n<p>\n3 2\n</p>\n<p>\n因为第3个操作跳回了第1个操作后，然而下一个指令是回到第2次操作后，这是不行的。\n</p>\n<h3>\n【输出格式】\n</h3>\n<p>\nn行，每行一个整数，表示每次操作后本质不同的回文子串个数。\n</p>\n<h3>\n【样例输入】\n</h3>\n<pre>在此键入。</pre>\n<h3>\n【样例输出】\n</h3>\n<pre>在此键入。</pre>\n<h3>\n【提示】\n</h3>\n<p>\n所有数据满足n&lt;=200000，设读入的字符串总长度为L，L&lt;=1000000\n</p>\n<p>\n对于20%的数据，不存在第二种命令；\n</p>\n<p>\n对于20%的数据，不存在第三种命令；\n</p>\n<p>\n对于20%的数据，L&lt;=100000；\n</p>\n<p>\n以上三种特殊数据互不交叉。\n</p>\n<h3>\n【备注】\n</h3>\n<p>\n这实际上是Mike做的一个梦……Mike活在理科1班\n</p>\n\n"}]}
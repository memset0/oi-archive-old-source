{"title":"[NOI2005] 瑰丽华尔兹","time_limit":1000,"memory_limit":128,"url":"http://cogs.pro:8080/cogs/problem/problem.php?pid=pNmmyQjqa","statement":[{"title":"题目描述","format":"html","require":["katex"],"content":"\n\n<p>\n【任务描述】\n</p>\n<p>\n你跳过华尔兹吗？当音乐响起，当你随着旋律滑动舞步，是不是有一种漫步仙境的惬意？众所周知，跳华尔兹时，最重要的是有好的音乐。但是很少有几个人知道，世界上最伟大的钢琴家一生都漂泊在大海上，他的名字叫丹尼?布德曼?T.D.?柠檬?1900，朋友们都叫他1900。\n</p>\n<p>\n1900出生于20世纪的第一年出生在往返于欧美的邮轮弗吉尼亚号上，然后就被抛弃了。1900刚出生就成了孤儿，孤独的成长在弗吉尼亚号上，从未离开过这个摇晃的世界；也许是对他命运的补偿，上帝派可爱的小天使艾米丽照顾他。\n</p>\n<p>\n可能是天使的点化，1900拥有不可思议的钢琴天赋，从未有人教，从没看过乐谱，但他却能凭着自己的感觉弹出最沁人心脾的旋律。当1900的音乐获得邮轮上所有人的欢迎时，他才8岁，而此时他已经乘着海轮往返欧美50多次了。\n</p>\n<p>\n虽说是钢琴奇才，但1900还是个8岁的孩子，他有着和一般男孩一样的好奇的调皮，不过可能更有一层浪漫的色彩罢了：\n</p>\n<p>\n这是一个风雨交加的夜晚，海风卷起层层巨浪拍打着弗吉尼亚号，邮轮随着巨浪剧烈的摇摆。船上的新萨克斯手迈克斯?托尼晕船了，1900将他 邀请到舞厅，然后——，然后松开了固定钢琴的闸，于是，钢琴随着海轮的倾斜滑动起来。准确的说，我们的主角1900、钢琴、邮轮随着1900的旋律一起跳 起了华尔兹，所有的事物好像都化为一体，随着“强弱弱”的节奏，托尼的晕船症也奇迹般地一点一点恢复。正如托尼在回忆录上这样写道：\n</p>\n<pre>大海摇晃着我们\n使我们转来转去\n快速的掠过灯和家具\n我意识到我们正在和大海一起跳舞\n真是完美而疯狂的舞者\n</pre>\n<p>\n晚上在金色的地板上快乐的跳着华尔兹是不是很惬意呢？也许，我们忘记了一个人，那就是艾米丽，她可没闲着：她必须在适当的时候施魔法帮助1900，不让钢琴碰上舞厅里的家具。而艾米丽还小，她无法施展魔法改变钢琴的运动方向或速度，而只能让钢琴停一下。\n</p>\n<p>\n不妨认为舞厅是一个N行M列的矩阵，矩阵中的某些方格上堆放了一些家具，其他的则是空地。钢琴可以在空地上滑动，但不能撞上家具或滑出舞厅，否则会损坏钢琴和家具，引来难缠的船长。\n</p>\n<p>\n每个时刻，钢琴都会随着船体倾斜的方向向相邻的方格滑动一格，其中相邻的方格可以是向东、向西、向南或向北的。而艾米丽可以选择施魔法或不施魔法，如果不施魔法，则钢琴会滑动，而如果施魔法，则钢琴会原地不动。 艾米丽是个天使，她知道每段时间的船体的倾斜情况。她想使钢琴尽量长时间在舞厅里滑行，这样1900会非常高兴，同时也有利于治疗托尼的晕船。但艾米丽还太小，不会算，所以希望你能帮助她。\n</p>\n<p>\n【输入格式】\n</p>\n<p>\n输入文件的第一行包含5个数N, M, x, y和K。N和M描述舞厅的大小，x和y为在第1时刻初钢琴的位置（x行y列）；我们对船体倾斜情况是按时间的区间来描述的，比如“在[1, 3]时间里向东倾斜，[4, 5]时间里向北倾斜”，因此这里的K表示区间的数目。\n</p>\n<p>\n以下N行，每行M个字符，描述舞厅里的家具。第i行第j列的字符若为‘ . &#39;，则表示该位置是空地；若为‘ x &#39;，则表示有家具。\n</p>\n<p>\n以下K行，顺序描述K个时间区间，格式为：si ti di(1 ≤ i ≤ K)。表示在时间区间[si, ti]内，船体都是向di方向倾斜的。di为1, 2, 3, 4中的一个，依次表示北、南、西、东（分别对应矩阵中的上、下、左、右）。输入保证区间是连续的，即\n</p>\n<ul>\n<li>\ns1 = 1\n</li>\n<li>\nti = si-1 + 1 (1 &lt; i ≤ K)\n</li>\n<li>\ntK = T\n</li>\n</ul>\n<p>\n【输出格式】\n</p>\n<p>\n输出文件仅有1行，包含一个整数，表示钢琴滑行的最长距离(即格子数)。\n</p>\n<p>\n【输入样例】\n</p>\n<pre>4 5 4 1 3\n..xx.\n.....\n...x.\n.....\n1 3 4\n4 5 1\n6 7 3</pre>\n<p>\n【输出样例】\n</p>\n<pre>6\n</pre>\n<p>\n【样例说明】\n</p>\n<p>\n钢琴的滑行路线：\n</p>\n<p>\n<img alt=\"Image:Adv1900.png\" src=\"../../../../mw/images/c/c5/Adv1900.png\" width=\"251\" height=\"202\"/> \n</p>\n<p>\n钢琴在“×位置上时天使使用一次魔法，因此滑动总长度为6。\n</p>\n<p>\n【评分方法】\n</p>\n<p>\n本题没有部分分，你的程序的输出只有和我们的答案完全一致才能获得满分，否则不得分。\n</p>\n<p>\n【数据范围】\n</p>\n<ul>\n<li>\n50%的数据中，1≤N, M≤200，T≤200；\n</li>\n<li>\n100%的数据中，1≤N, M≤200，K≤200，T≤40000。\n</li>\n</ul>\n\n"}]}
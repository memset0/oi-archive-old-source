{"title":"【WC2019】数树","time_limit":0,"memory_limit":0,"url":"http://uoj.ac/problem/457","statement":[{"title":"题目描述","format":"html","require":["katex"],"content":"\n<p>白兔喜欢树。</p>\n<p>白云喜欢数数。</p>\n<p>有 $n$ 只鼠，白兔用 $n − 1$ 根蓝色绳子把它们连成了一棵树，每根蓝色绳子连着两只鼠，白云用 $n − 1$ 根红色绳子把它们连成了一棵树，每根红色绳子连接着两只鼠。</p>\n<p>白云要给予每只鼠一个数。这个数可以是 $[1, y]$ 中的任意一个整数。</p>\n<p>白兔给了白云一个要求：对于两只鼠 $p, q$，若存在一条连接这两只鼠的路径同时属于这两棵树，则 $p$ 和 $q$ 必须被给予相同的整数。存在一条路径同时属于这两棵树指的是：存在一个序列 $(a_1 = p, a_2, \\cdots , a_m = q)$，使得：对于所有 $i \\in [1, m − 1]$，都有 $a_i$ 和 $a_{i+1}$ 既有一根红色绳子直接相连也有一根蓝色绳子直接相连。</p>\n<p>白云想知道，她有多少种给予数的方案呢？</p>\n<p>鼠在不停地挣扎，想要摆脱绳子的束缚。白云还没有思考出来，鼠便把红色绳子都咬断了。</p>\n<p>白兔有些气恼，但是他还是想要知道答案。他便问白云：对于所有红色绳子的连接方案，答案的总和（即求所有红色绳子连接方案的给予数方案之和）是多少？</p>\n<p>鼠在不停地挣扎，想要摆脱绳子的束缚。白云还没有思考出来，鼠便把蓝色绳子也咬断了。</p>\n<p>白兔有些气恼，但是他还是想要知道答案。他便问白云：对于所有红色和蓝色绳子的连接方案，答案的总和（即求所有红色和蓝色绳子连接方案的给予数方案之和）是多少？两个方案不同当且仅当存在至少一对鼠，在两种方案中，这两只鼠之间直接连接的绳子不同（两只鼠之间连接绳子的可能性有 4 种：没有绳子直接连接，只有红色绳子直接连接，只有蓝色绳子直接连接，两种颜色的绳子均直接连接）。</p>\n<p>白云哭了。</p>\n<h4>题目描述</h4>\n<p>本题包含三个问题：\n- 问题 0：已知两棵 $n$ 个节点的树的形态（两棵树的节点标号均为 $1$ 至 $n$），其中第一棵树是红树，第二棵树是蓝树。要给予每个节点一个 $[1, y]$ 中的整数，使得对于任意两个节点 $p, q$，如果存在一条路径 $(a_1 = p, a_2, \\cdots , a_m = q)$ 同时属于这两棵树，则 $p, q$ 必须被给予相同的数。求给予数的方案数。\n  - 存在一条路径同时属于这两棵树的定义见「题目背景」。\n- 问题 1：已知蓝树，对于红树的所有 $n^{n−2}$ 种选择方案，求问题 0 的答案之和。\n- 问题 2：对于蓝树的所有 $n^{n−2}$ 种选择方案，求问题 1 的答案之和。</p>\n<p>提示：$n$ 个节点的树一共有 $n^{n−2}$ 种。</p>\n<p>在不同的测试点中，你将可能需要回答不同的问题。我们将用 $\\text{op}$ 来指代你需要回答的问题编号（对应上述 0、 1、 2）。</p>\n<p>由于答案可能很大，因此你只需要输出答案对 $998, 244, 353$ 取模的结果即可。</p>\n"},{"title":"输入格式","format":"html","require":["katex"],"content":"\n\n<p>从标准输入中读入数据。</p>\n<p>第一行三个用空格隔开的整数 $n, y, \\text{op}$。</p>\n<p>如果 $\\text{op} = 0$，则接下来 $2 \\times (n − 1)$ 行，前 $(n − 1)$ 行每描述一条蓝色绳子，接下来 $(n − 1)$ 行每行描述一条红色绳子。  </p>\n<p>如果 $\\text{op} = 1$，则接下来 $(n − 1)$ 行，每行描述一条蓝色绳子。  </p>\n<p>如果 $\\text{op} = 2$，则接下来没有输入。  </p>\n<p>描述绳子的各行将包含两个用空格隔开的整数，分别表示被这条绳子连接的两只鼠的编号。鼠的编号是从 $1$ 开始的。</p>\n"},{"title":"输出格式","format":"html","require":["katex"],"content":"\n\n<p>输出到标准输出中。</p>\n<p>输出一个整数，表示答案对 $998, 244, 353$ 取模的结果。</p>\n"},{"title":"样例一","format":"html","require":["katex"],"content":"\n\n<h4>input</h4>\n<pre><code>3 2 0\n1 2\n2 3\n1 2\n2 3</code></pre>\n<h4>output</h4>\n<pre><code>2</code></pre>\n<h4>explanation</h4>\n<p>两棵树相同，所以任意两个点都必须被给予相同的数，方案数为 $2$。</p>\n"},{"title":"样例二","format":"html","require":["katex"],"content":"\n\n<h4>input</h4>\n<pre><code>3 2 1\n1 2\n2 3</code></pre>\n<h4>output</h4>\n<pre><code>10</code></pre>\n<h4>explanation</h4>\n<p>红树共有三种可能的情况：\n1. 包含绳子 $(1, 2)$（表示连接 $1, 2$ 号鼠的绳子，下同）、$(2, 3)$：此时任意两只鼠都必须被给予相同的数，问题 0 的答案为 $2$。\n2. 包含绳子 $(1, 2)$、$(1, 3)$：此时 $1$ 号鼠和 $2$ 号鼠必须被给予相同的数，问题 0 的答案为 $2 \\times 2 = 4$。\n3. 包含绳子 $(2, 3)$、$(1, 3)$：此时 $2$ 号点和 $3$ 号点必须被给予相同的数，问题 0 的答案为 $2 \\times 2 = 4$。</p>\n<p>综上，问题 1 的答案为 $2 + 4 + 4 = 10$。</p>\n"},{"title":"样例三","format":"html","require":["katex"],"content":"\n\n<h4>input</h4>\n<pre><code>3 2 2</code></pre>\n<h4>output</h4>\n<pre><code>30</code></pre>\n<h4>explanation</h4>\n<p>蓝树一共有三种可能的情况。不难发现，对于蓝树的每一种情况，求得的问题 1 的答案都是 $10$。所以答案为 $10 \\times 3 = 30$。</p>\n"},{"title":"样例四至样例六","format":"html","require":["katex"],"content":"\n\n<p>见样例数据下载。</p>\n"},{"title":"限制与约定","format":"html","require":["katex"],"content":"\n\n<p>对于所有测试数据：$3 \\le n \\le 10^5， 1 \\le y \\lt 998244353， \\text{op} \\in \\{0, 1, 2\\}$。</p>\n <div class=\"table-responsive\">\n<table class=\"table table-bordered table-text-center table-verticle-middle\"><thead><tr><th>问题类型 $=$</th><th>测试点编号</th><th>$n$</th><th>$y$</th><th>集训队每个测试点分值</th><th>非集训队每个测试点分值</th></tr></thead><tbody><tr><td> 0 </td><td> 1 </td><td> $\\le 10$ </td><td> 无特殊限制 </td><td> 2 </td><td> 18 </td></tr><tr><td> 0 </td><td> 2 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 2 </td><td> 5 </td></tr><tr><td> 0 </td><td> 3 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 2 </td><td> 5 </td></tr><tr><td> 1 </td><td> 4 </td><td> $=3$ </td><td> 无特殊限制 </td><td> 1 </td><td> 4 </td></tr><tr><td> 1 </td><td> 5 </td><td> $=5$ </td><td> 无特殊限制 </td><td> 1 </td><td> 4 </td></tr><tr><td> 1 </td><td> 6 </td><td> $\\le 500$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 1 </td><td> 7 </td><td> $\\le 500$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 1 </td><td> 8 </td><td> $\\le 5000$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 1 </td><td> 9 </td><td> $\\le 5000$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 1 </td><td> 10 </td><td> $\\le 10^5$ </td><td> $=1$ </td><td> 1 </td><td> 4 </td></tr><tr><td> 1 </td><td> 11 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr><tr><td> 1 </td><td> 12 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr><tr><td> 1 </td><td> 13 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr><tr><td> 1 </td><td> 14 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr><tr><td> 2 </td><td> 15 </td><td> $=3$ </td><td> 无特殊限制 </td><td> 1 </td><td> 4 </td></tr><tr><td> 2 </td><td> 16 </td><td> $=10$ </td><td> 无特殊限制 </td><td> 1 </td><td> 4 </td></tr><tr><td> 2 </td><td> 17 </td><td> $\\le 500$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 2 </td><td> 18 </td><td> $\\le 500$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 2 </td><td> 19 </td><td> $\\le 5000$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 2 </td><td> 20 </td><td> $\\le 5000$ </td><td> 无特殊限制 </td><td> 6 </td><td> 4 </td></tr><tr><td> 2 </td><td> 21 </td><td> $\\le 10^5$ </td><td> $=1$ </td><td> 1 </td><td> 4 </td></tr><tr><td> 2 </td><td> 22 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr><tr><td> 2 </td><td> 23 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr><tr><td> 2 </td><td> 24 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr><tr><td> 2 </td><td> 25 </td><td> $\\le 10^5$ </td><td> 无特殊限制 </td><td> 5 </td><td> 2 </td></tr></tbody></table></div>\n\n<p>为了优化你的阅读体验，我们把<strong>测试点编号</strong>放在了表格的中间，请注意这一点。</p>\n<p>在 UOJ 上，提交的程序将按照「集训队每个测试点分值」一栏的分值进行评分。</p>\n<p><strong>时间限制: 4s</strong></p>\n<p><strong>空间限制: 512MB</strong></p>\n"},{"title":"下载","format":"html","require":["katex"],"content":"\n\n<p><a href=\"/download.php?type=problem&amp;id=457\">样例数据下载</a></p>\n\n"}]}
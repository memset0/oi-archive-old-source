{"title":"【UR #14】思考熊","time_limit":4000,"memory_limit":300,"url":"http://uoj.ac/problem/194","statement":[{"title":"# 题目描述","format":"html","require":["katex"],"content":"\n<p>随着人类补完计划的成功，人类也制造出了它们所拥有的第一个同样也是唯一一个超级士兵——战争中凋敝的国力已经无法为再一次的人体改造提供足够的能源与人力。但是，就这唯一的超级士兵，在接下来的战争中，也给跳蚤国带去了巨大的损失。</p>\n<p>在经历了漫长的僵持后，终于，长时间的战争带来的损伤让双方都难以接受了。于是，双方决定以王牌对王牌决斗的形式，来结束这场毫无意义的争斗。</p>\n<p>那一天，是最强跳蚤与超级士兵第一次相遇同时也是最后一次相遇：他们带来了无愧于他们最强之名的旷世对决。最终，最强跳蚤的子弹贯穿了超级士兵的咽喉，而超级士兵在生命尽头时斩出的一刀也准确无误地击中了最强跳蚤唯一的弱点——脚踵。重伤的最强跳蚤在惊慌之中全力一跳，消失在了天空中，之后再也没有人见到过它的踪影。</p>\n<p>这场决斗以平局的形式告终，而双方又都不肯进行让步，所以本该熄灭的战火又蔓延开来。然而，回到原点的战争中，失去了最强跳蚤的跳蚤国再一次落在了下风。</p>\n<p>终于，战争的损耗让跳蚤国再也没有力量维持这一场轰轰烈烈的远征。在最后的最后，跳蚤国王决定最后尝试一次智取：他命令手下的工匠制作一个巨大的思考熊，并将几百名最精锐的跳蚤士兵藏身其中，接着他假装退兵，在人们将思考熊当做战利品带进城里后，里应外合夜袭 pion 吧，力求一击而中。</p>\n<p>然而，现实往往没有那么简单。跳蚤国王希望可以选择一种最妥当的方案，来提高这最后一次努力的成功率，于是他要对计划的进行进行反复的模拟与推敲。</p>\n<p>pion 吧中有 $n$ 个居住区，<strong>这些居住区被 $n-1$ 条双向道路连成了一个树形结构（即任意两个居住区之间有且只有一条简单路径）</strong>。每一条道路都有一个安全度 $w_i$（<strong>$w_i$ 可能为负数表示这条路非常危险</strong>）。<strong>跳蚤士兵经过一条路径的安全度为经过的所有道路的安全度之和。</strong></p>\n<p>在分析的过程中，跳蚤国王有一个序列 $A$ 表示可以进行接应的居住区编号，最开始序列 $A$ 为空。</p>\n<p>接着跳蚤国王进行了 $m$ 次模拟操作，每一次操作都是一下三种事件之一：</p>\n<ol><li>发现了一个新的接应点，它是编号为 $x$ 的居住区，跳蚤国王把它放在了序列 $A$ 的最后。</li>\n<li>序列末尾的接应点被人类发现并捣毁，即序列末尾的接应点被删除。</li>\n<li>跳蚤国王假设只有当前序列中第 $l$ 个到第 $r$ 个（按照插入时间从小到大编号）接应点可以使用且思考熊被人类放在了第 $x$ 号居住区。跳蚤士兵们需要选择一个可以使用的接应点并<strong>沿着唯一的那条简单路径赶到那儿接应跳蚤大军</strong>。跳蚤国王想要知道所有选择中<strong>最大</strong>的安全度是多少。</li>\n</ol><p>因为跳蚤国王想要模拟尽可能多的情况，所以运算量变得相当的大。于是他希望由你——不堪受辱刚刚从 pion 吧叛逃出来的人类，来帮他进行计算。</p>\n"},{"title":"# 输入格式","format":"html","require":["katex"],"content":"\n\n<p>第一行两个正整数 $n$ 和 $m$ 分别表示居住区的个数和操作个数。</p>\n<p>接下来 $n-1$ 行每行三个整数 $u_i,v_i,w_i(1 \\leq u_i,v_i \\leq n)$ 描述树上的一条边权为 $w_i$ 的连接点 $u_i$ 和 $v_i$ 的边。</p>\n<p>接下来 $m$ 行，每行第一个整数 $t_i$ 描述操作种类：</p>\n<ol><li>如果 $t_i=1$，那么接下来一个整数 $x_i$，表示加入的居住区编号。</li>\n<li>如果 $t_i=2$，那么表示删除最后一次加入的居住区。</li>\n<li>如果 $t_i=3$，那么接下来三个整数 $l_i,r_i,x_i$，表示一次询问。</li>\n</ol><p>因为一些原因，本题对第一种操作中的 $x_i$ 和第三种操作中的 $l_i,r_i,x_i$ 进行了加密，假设输入的数是 $\\text{num}$，上一次询问的答案是 $\\text{last}$（初始为0），那么解密方式如下：</p>\n<ol><li>在读入 $x_i$ 的时候，$x_i$ 的实际值等于 $(\\text{num}\\ \\text{xor}\\ |\\text{last}|)\\ \\text{mod}\\ n+1$。</li>\n<li>在读入 $l_i,r_i$ 的时候，它们的实际值等于 $(\\text{num}\\ \\text{xor}\\ |\\text{last}|)\\ \\text{mod}\\ N+1$，其中 $N$ 为当前的数列长度。<strong>注意如果解密时出现了 $l_i &gt; r_i$ 的情况，你需要自行交换 $l_i$ 和 $r_i$ 的值，保证比赛时的数据中不会出现这种情况。</strong></li>\n</ol><p>其中 $\\text{xor}$ 表示在二进制下逐位异或。</p>\n<p>数据保证有 $0 \\leq \\text{num} \\leq 2 \\times 10^9$。</p>\n"},{"title":"# 输出格式","format":"html","require":["katex"],"content":"\n\n<p>对每一次询问输出一行一个整数，表示答案。</p>\n<p><strong>因为这题输入输出数据较为庞大，请选手注意减少读入输出时使用的时间。</strong></p>\n"},{"title":"# 样例一","format":"html","require":["katex"],"content":"\n\n<h4>input</h4>\n<pre>5 10\n1 2 -269\n2 3 27\n3 4 -185\n4 5 252\n1 2\n3 0 0 3\n3 185 185 185\n2\n1 240\n2\n1 246\n1 246\n3 242 242 241\n2\n\n</pre>\n\n<h4>output</h4>\n<pre>-185\n-242\n252\n\n</pre>\n\n<h4>explanation</h4>\n<p>第一次询问时，序列为 $3$，答案是树上 $3$ 到 $4$ 的距离，即 $-185$。</p>\n<p>第二次询问时，序列为 $3$，答案是树上 $3$ 到 $1$ 的距离，即 $-242$。</p>\n<p>第三次询问时，序列为 $5\\ 5$，答案是树上 $5$ 到 $4$ 的距离，即 $252$。</p>\n"},{"title":"# 样例二","format":"html","require":["katex"],"content":"\n\n<p>见样例数据下载，该数据满足 $n,m \\leq 1000$。</p>\n"},{"title":"# 样例三","format":"html","require":["katex"],"content":"\n\n<p>见样例数据下载，该数据满足 $n,m \\leq 100000$ 且不存在第二类操作。</p>\n"},{"title":"# 样例四","format":"html","require":["katex"],"content":"\n\n<p>见样例数据下载，该数据满足 $n,m \\leq 100000$ 且 $w_i \\geq 0$。</p>\n"},{"title":"# 样例五","format":"html","require":["katex"],"content":"\n\n<p>见样例数据下载，该数据满足 $n,m \\leq 100000$。</p>\n"},{"title":"# 限制与约定","format":"html","require":["katex"],"content":"\n\n<p>由于一些原因，本题使用捆绑测试。每个子任务有若干个测试点，分为 $6$ 个子任务，你只有通过一个子任务的所有测试点才能得到这个子任务的分数。</p>\n<div class=\"table-responsive\">\n<table class=\"table table-bordered table-text-center table-vertical-middle\"><thead><tr><th>子任务</th>\n<th>分值</th>\n<th>$n$ 的规模</th>\n<th>$m$ 的范围\n</th><th>其他约定</th>\n</tr></thead><tbody><tr><td>1</td><td>7</td><td>$n \\leq 1000$</td><td>$m \\leq 1000$</td><td rowspan=\"3\"></td></tr><tr><td>2</td><td>13</td><td>$n \\leq 10000$</td><td>$m \\leq 20000$</td></tr><tr><td>3</td><td>20</td><td>$n \\leq 100000$</td><td>$m \\leq 100000$</td></tr><tr><td>4</td><td>20</td><td rowspan=\"3\">$n \\leq 300000$</td><td rowspan=\"3\">$m \\leq 300000$</td><td>保证没有第二类操作</td></tr><tr><td>5</td><td>20</td><td>$w_i \\geq 0$</td></tr><tr><td>6</td><td>20</td><td></td></tr></tbody></table></div>\n\n<p>对于所有数据，有 $0 \\leq |w_i| \\leq 300$。</p>\n<p><strong>时间限制：</strong>$4\\texttt{s}$</p>\n<p><strong>空间限制：</strong>$300\\texttt{MB}$</p>\n"},{"title":"# 下载","format":"html","require":["katex"],"content":"\n\n<p><a href=\"/download.php?type=problem&amp;id=194\">样例数据下载</a></p>\n"},{"title":"# 后记","format":"html","require":["katex"],"content":"\n\n<p>最终，跳蚤国王的计策成功了：他凭借着一条思考熊计，攻破了 pion 吧，结束了这场旷日持久的战争。</p>\n<p>然而，出乎他的意料的是，pion 吧的管理层——吧主、小吧主甚至是视频小编、图片小编都在一夜之间失踪了——pion 吧这个曾经无比辉煌的大都市成为了无主之地，混乱不堪。</p>\n<p>跳蚤国王计上心头，他化名成了“伏特跳蚤国王”，伪装成了人类并打入了他们内部，创建了一个名叫 Universal OJ 用户群的神秘组织，并利用他在 pion 吧当吧主时的管理经验与人脉关系，将 pion 吧最后残存的力量拉入他的组织并秘密地加以监视与控制。</p>\n<p>多年之后的现在，人类的文明以 Universal OJ 用户群为中心，又一次达到了鼎盛，而原来强大的跳蚤帝国，却在那场战争后突然地从历史的舞台中消失了。人们都沉浸在了繁荣的经济与文化带来的高质量生活中，却很少有人依然记得多少年前的那一场战争以及那一场战争中真正的赢家...</p>\n\n"}]}
{"title":"动态仙人掌 III","time_limit":5000,"memory_limit":256,"url":"http://uoj.ac/problem/65","statement":[{"title":"题目描述","format":"html","require":["katex"],"content":"\n<p>有一天，VFleaKing到森林里游玩，回来之后跟pyx1997说，我发现好多棵会动的树耶！pyx1997说，这有什么好稀奇的，我用手指头就能维护每棵树的形态。</p>\n<p>于是又过了几天VFleaKing到沙漠里游玩，回来之后跟pyx1997说，我发现好多棵会动的仙人掌耶！pyx1997说，这有什么好稀奇的，我用脚丫子就能维护每棵仙人掌的形态。</p>\n<p>于是VFleaKing很郁闷，他向你求助，请帮帮他吧。</p>\n<p>如果一个无向连通图的任意一条边最多属于一个简单环，我们就称之为仙人掌。</p>\n<p>如果一个无向图的每个连通块都是个仙人掌，且不存在自环，我们就称之为沙漠。</p>\n<p>为了证明你确实能够维护仙人掌，我们给你 $n$ 个结点，从 $1$ 到 $n$ 标号。初始时没有任何边。每次进行如下操作之一：</p>\n<ol><li>link $v$ $u$ $w_a$ $w_b$：在结点 $v, u$ 间连一条权值A为 $w_a$、权值B为 $w_b$ 的边。<ul><li>$1 \\leq v, u \\leq n$ 且 $w_a, w_b$ 为正整数。</li>\n<li>如果连边完成后图仍为沙漠，则输出 &#34;<samp>ok</samp>&#34;（不含引号）。</li>\n<li>否则操作非法，撤销此次操作并输出 &#34;<samp>failed</samp>&#34;（不含引号）。</li>\n</ul></li>\n<li>cut $v$ $u$ $w_a$ $w_b$：在结点 $v, u$ 间删掉一条权值A为 $w_a$、权值B为 $w_b$ 的边。<ul><li>$1 \\leq v, u \\leq n$ 且 $w_a, w_b$ 为正整数。</li>\n<li>如果存在这样的边则输出 &#34;<samp>ok</samp>&#34;（不含引号）（如果有多条权值A为 $w_a$、权值B为 $w_b$ 的边删去任意一条）。</li>\n<li>否则操作非法，不进行操作并输出 &#34;<samp>failed</samp>&#34;（不含引号）。</li>\n</ul></li>\n<li>distance? $v$ $u$：查询结点 $v$ 到结点 $u$ 的按权值A计算的最短路信息。<ul><li>$1 \\leq v, u \\leq n$。</li>\n<li>输出两个用空格隔开的整数 $l_m, w_m$。</li>\n<li>$l_m$ 代表按权值A计算的最短路的长度，$w_m$代表最短路上的边的权值B的最小值。</li>\n<li>如果 $v = u$ 则 $l_m = 0, w_m = 2147483647$。</li>\n<li>如果没有路可到达则 $l_m = -1, w_m = -1$。</li>\n<li>如果最短路不唯一则 $w_m = -1$。</li>\n</ul></li>\n<li>add $v$ $u$ $d$：把结点 $v$ 到结点 $u$ 的按权值A计算的最短路上的每一条边的权值B都加上 $d$。<ul><li>$1 \\leq v, u \\leq n$, $v \\neq u$ 且 $d$ 为正整数。</li>\n<li>如果有路可到达且最短路唯一，则输出 &#34;<samp>ok</samp>&#34;（不含引号）</li>\n<li>否则操作非法，不进行操作并输出 &#34;<samp>failed</samp>&#34;（不含引号）。</li>\n</ul></li>\n</ol>"},{"title":"输入格式","format":"html","require":["katex"],"content":"\n\n<p>第一行两个用空格隔开的正整数 $n, m$ 表示一共有 $n$ 个结点，$m$ 个操作。</p>\n<p>接下来 $m$ 行，每行代表一个操作。</p>\n"},{"title":"输出格式","format":"html","require":["katex"],"content":"\n\n<p>对于每个操作，输出相应的结果。</p>\n"},{"title":"样例一","format":"html","require":["katex"],"content":"\n\n<h4>input</h4>\n<pre>6 56\nlink 1 2 1 3\nlink 1 2 2 5\ndistance? 1 2\ncut 1 2 1 3\nlink 1 2 2 5\ndistance? 1 2\ncut 1 2 2 5\nlink 1 2 2 4\nadd 1 2 1\ncut 1 2 2 4\ncut 1 2 2 5\nlink 3 3 2 2\ncut 4 4 2 2\nlink 1 2 2 4\nlink 1 3 3 5\nlink 2 3 4 3\ndistance? 1 2\ndistance? 1 3\ndistance? 2 4\nadd 1 2 3\nlink 2 4 3 2\nlink 3 5 3 4\nlink 4 5 1 5\ndistance? 4 5\ncut 1 2 2 7\nlink 4 5 5 4\ndistance? 1 5\ncut 2 3 4 3\nlink 2 5 5 3\nlink 1 5 2 4\ndistance? 1 2\nadd 3 4 3\ncut 4 5 5 7\ndistance? 1 2\ncut 3 5 3 7\ndistance? 1 2\ncut 2 5 5 4\ncut 2 5 5 3\ndistance? 1 2\nadd 1 2 3\nlink 3 5 6 7\ndistance? 1 3\nadd 3 5 1\ndistance? 5 3\ndistance? 4 3\nlink 4 6 3 1\nlink 2 6 7 2\ndistance? 2 6\nlink 5 6 2 4\ndistance? 1 6\ndistance? 2 3\ncut 2 4 3 2\nlink 2 5 4 3\ndistance? 4 1\ncut 4 6 3 1\ndistance? 4 1\n\n</pre>\n\n<h4>output</h4>\n<pre>ok\nok\n1 3\nok\nok\n2 -1\nok\nok\nfailed\nok\nok\nfailed\nfailed\nok\nok\nok\n2 4\n3 5\n-1 -1\nok\nok\nok\nfailed\n10 2\nok\nok\n6 4\nok\nok\nok\n7 3\nok\nok\n7 3\nok\n7 3\nfailed\nok\n-1 -1\nfailed\nok\n3 5\nok\n5 5\n-1 -1\nok\nok\n6 1\nok\n4 4\n13 1\nok\nok\n7 1\nok\n-1 -1\n\n</pre>\n\n"},{"title":"限制与约定","format":"html","require":["katex"],"content":"\n\n<p>$1 \\leq n \\leq 100000, 1 \\leq m \\leq 500000$。</p>\n<p>保证 link 和 cut 操作中的 $w_a$ 满足 $1 \\leq w_a \\leq 10000$，$1 \\leq w_b \\leq 10^9$，且 add 操作中的 $d$ 之和不超过 $10^9$。所以关于边权的计算不会超出 32 位有符号整数范围。</p>\n<p><strong>时间限制：</strong>$5\\texttt{s}$</p>\n<p><strong>空间限制：</strong>$256\\texttt{MB}$</p>\n"},{"title":"下载","format":"html","require":["katex"],"content":"\n\n<p><a href=\"/download.php?type=problem&amp;id=65\">样例数据下载</a></p>\n\n"}]}